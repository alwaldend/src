load("@bazel_skylib//rules:build_test.bzl", "build_test")
load("@rules_kotlin//kotlin:android.bzl", "kt_android_library")
load("@rules_kotlin//kotlin:core.bzl", "kt_compiler_plugin")

_PACKAGE = "com.alwaldend.src.kt.android.launcher"

filegroup(
    name = "main",
    srcs = glob(["**/*.kt"]),
)

kt_compiler_plugin(
    name = "jetpack_compose_compiler_plugin",
    id = "org.jetbrains.kotlin.android",
    target_embedded_compiler = True,
    deps = ["@com_alwaldend_src_projects_android_launcher_maven//:org_jetbrains_kotlin_kotlin_compose_compiler_plugin_embeddable"],
)

kt_android_library(
    name = "launcher_library",
    srcs = [":main"],
    custom_package = _PACKAGE,
    manifest = "//projects/android_launcher:manifest",
    plugins = [":jetpack_compose_compiler_plugin"],
    proguard_specs = ["//projects/android_launcher:proguard"],
    resource_files = ["//projects/android_launcher/res"],
    visibility = ["//projects/android_launcher:__subpackages__"],
    deps = [
        "//contracts/android_launcher:model_java_import",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_activity_activity_compose",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_compose_foundation_foundation_layout",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_compose_material3_material3",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_compose_runtime_runtime",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_compose_ui_ui",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_compose_ui_ui_tooling",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_datastore_datastore",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_lifecycle_lifecycle_viewmodel_compose",
        "@com_alwaldend_src_projects_android_launcher_maven//:androidx_navigation_navigation_compose",
        "@com_alwaldend_src_projects_android_launcher_maven//:com_google_guava_guava",
        "@protobuf//:protobuf_javalite",
    ],
)

android_binary(
    name = "launcher_binary",
    manifest = "//projects/android_launcher:manifest",
    manifest_values = {
        "versionCode": "0",
        "versionName": "0.0.0",
        "applicationId": _PACKAGE,
    },
    deps = [":launcher_library"],
)

build_test(
    name = "test_builds",
    targets = [
        ":launcher_binary",
    ],
)
