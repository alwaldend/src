[[Submissions]]
  Id = 1916085924
  StatusDisplay = "Accepted"
  Lang = "python3"
  QuestionId = 4047
  TitleSlug = "longest-balanced-subarray-ii"
  Code = "class LazyTag:\n    def __init__(self):\n        self.to_add = 0\n\n    def add(self, other):\n        self.to_add += other.to_add\n        return self\n\n    def has_tag(self):\n        return self.to_add != 0\n\n    def clear(self):\n        self.to_add = 0\n\n\nclass SegmentTreeNode:\n    def __init__(self):\n        self.min_value = 0\n        self.max_value = 0\n        self.lazy_tag = LazyTag()\n\n\nclass SegmentTree:\n    def __init__(self, data):\n        self.n = len(data)\n        self.tree = [SegmentTreeNode() for _ in range(self.n * 4 + 1)]\n        self._build(data, 1, self.n, 1)\n\n    def add(self, l, r, val):\n        tag = LazyTag()\n        tag.to_add = val\n        self._update(l, r, tag, 1, self.n, 1)\n\n    def find_last(self, start, val):\n        if start > self.n:\n            return -1\n        return self._find(start, self.n, val, 1, self.n, 1)\n\n    def _apply_tag(self, i, tag):\n        self.tree[i].min_value += tag.to_add\n        self.tree[i].max_value += tag.to_add\n        self.tree[i].lazy_tag.add(tag)\n\n    def _pushdown(self, i):\n        if self.tree[i].lazy_tag.has_tag():\n            tag = LazyTag()\n            tag.to_add = self.tree[i].lazy_tag.to_add\n            self._apply_tag(i << 1, tag)\n            self._apply_tag((i << 1) | 1, tag)\n            self.tree[i].lazy_tag.clear()\n\n    def _pushup(self, i):\n        self.tree[i].min_value = min(\n            self.tree[i << 1].min_value, self.tree[(i << 1) | 1].min_value\n        )\n        self.tree[i].max_value = max(\n            self.tree[i << 1].max_value, self.tree[(i << 1) | 1].max_value\n        )\n\n    def _build(self, data, l, r, i):\n        if l == r:\n            self.tree[i].min_value = data[l - 1]\n            self.tree[i].max_value = data[l - 1]\n            return\n\n        mid = l + ((r - l) >> 1)\n        self._build(data, l, mid, i << 1)\n        self._build(data, mid + 1, r, (i << 1) | 1)\n        self._pushup(i)\n\n    def _update(self, target_l, target_r, tag, l, r, i):\n        if target_l <= l and r <= target_r:\n            self._apply_tag(i, tag)\n            return\n\n        self._pushdown(i)\n        mid = l + ((r - l) >> 1)\n        if target_l <= mid:\n            self._update(target_l, target_r, tag, l, mid, i << 1)\n        if target_r > mid:\n            self._update(target_l, target_r, tag, mid + 1, r, (i << 1) | 1)\n        self._pushup(i)\n\n    def _find(self, target_l, target_r, val, l, r, i):\n        if self.tree[i].min_value > val or self.tree[i].max_value < val:\n            return -1\n\n        if l == r:\n            return l\n\n        self._pushdown(i)\n        mid = l + ((r - l) >> 1)\n\n        if target_r >= mid + 1:\n            res = self._find(target_l, target_r, val, mid + 1, r, (i << 1) | 1)\n            if res != -1:\n                return res\n\n        if l <= target_r and mid >= target_l:\n            return self._find(target_l, target_r, val, l, mid, i << 1)\n\n        return -1\n\n\nclass Solution:\n    def longestBalanced(self, nums: List[int]) -> int:\n        occurrences = defaultdict(deque)\n\n        def sgn(x):\n            return 1 if x % 2 == 0 else -1\n\n        length = 0\n        prefix_sum = [0] * len(nums)\n        prefix_sum[0] = sgn(nums[0])\n        occurrences[nums[0]].append(1)\n\n        for i in range(1, len(nums)):\n            prefix_sum[i] = prefix_sum[i - 1]\n            occ = occurrences[nums[i]]\n            if not occ:\n                prefix_sum[i] += sgn(nums[i])\n            occ.append(i + 1)\n\n        seg = SegmentTree(prefix_sum)\n        for i in range(len(nums)):\n            length = max(length, seg.find_last(i + length, 0) - i)\n            next_pos = len(nums) + 1\n            occurrences[nums[i]].popleft()\n            if occurrences[nums[i]]:\n                next_pos = occurrences[nums[i]][0]\n\n            seg.add(i + 1, next_pos - 1, -sgn(nums[i]))\n\n        return length"
  Title = "Longest Balanced Subarray II"
  Url = "/submissions/detail/1916085924/"
  LangName = "Python3"
  Timestamp = 1770829958
  Status = 10
  Runtime = "8295 ms"
  IsPending = "Not Pending"
  Memory = "183 MB"
  CompareResult = "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
  HasNotes = false
  FlagType = 1
